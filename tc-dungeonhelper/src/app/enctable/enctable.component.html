<!-- Display filtered encounters -->


<div class="palkki">
  <button mat-flat-button routerLink="/retables">Back</button>
  <mat-card-title>{{ filteredEncounters.biome }}</mat-card-title>
  <mat-slide-toggle (click)="toggleEditMode()">{{ isEditing ?
    'Quit editing'
    : 'Edit' }}</mat-slide-toggle>




</div>

<button *ngIf="!isEditing" class="editti" mat-flat-button style="background-color:#C5231D;"
  (click)="addEncounterModalOpen()">Add new</button>




<div class="encounter-container">

  <div class="encounter-item" *ngFor="let enc of filteredEncounters?.enc; let i = index"
    [ngClass]="{'even-item': i % 2 === 0, 'odd-item': i % 2 !== 0}">

    <span class="item-number">{{ i + 1 }}.</span>

    <!-- Material styling for editing encounter name -->
    <span class="item-name" *ngIf="!enc.isEditing" (click)="openEncounterModal(enc)">{{ enc.name }}</span>
    <mat-form-field class="formi" *ngIf="enc.isEditing">
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="enc.name" />
    </mat-form-field>

    <!-- Material textarea for editing encounter description -->
    <mat-form-field class="formi" *ngIf="enc.isEditing">
      <mat-label>Description</mat-label>
      <textarea matInput [(ngModel)]="enc.description"></textarea>
    </mat-form-field>

    <mat-form-field class="formi" *ngIf="enc.isEditing">
      <mat-label>Roll</mat-label>
      <input matInput [(ngModel)]="enc.roll" />
    </mat-form-field>

    <div *ngIf="isEditing" class="item-weight-container">
      <div class="weight-percent-container">

        <!-- Weight-painikkeet -->
        <div class="weight-buttons">
          <button mat-icon-button (click)="increaseWeight(enc); $event.stopPropagation()">&#9650;</button>
          <span class="item-weight">{{ enc.weight }}</span>
          <button mat-icon-button (click)="decreaseWeight(enc); $event.stopPropagation()">&#9660;</button>
        </div>

        <!-- Prosentti -->
        <span class="item-percent1">{{ percentCalc(enc.weight, w()) }} %</span>
      </div>

      <!-- Save ja Delete-painikkeet -->
      <div class="edit-buttons">

        <button mat-button (click)="saveEnc()">Save</button>

        <button mat-button (click)="confirmDelete(filteredEncounters._id, enc._id)"><span
            class="material-symbols-outlined" style="color: white;">
            delete</span>
        </button>
      </div>

    </div>

    <span class="item-percent">{{ percentCalc(enc.weight, w()) }} %</span>
  </div>

  <!-- Button container with Material buttons -->
  <div class="button-container">

    <div class="dice-container">
      <button mat-flat-button style="background-color:#C5231D; color:white" [disabled]="isEditing"
        (click)="rollTable()">Roll</button>
    </div>

  </div>